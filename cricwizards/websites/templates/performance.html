{% extends "base.html" %}

{% block content %}
<div class="performance-analysis">
    <h1 class="mb-4">{{ team_name }} Performance Analysis</h1>
    
    <!-- All-Rounder Analysis -->
    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
            <h2 class="h5 mb-0">All-Round Performances</h2>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover" id="allrounder-table">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="name">Player <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="matches">Matches <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="runs">Runs <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="batting_average">Bat Avg <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="strike_rate">SR <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="wickets">Wickets <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="economy">Economy <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="bowling_average">Bowl Avg <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="all_round_rating">Rating <span class="sort-icon">↕</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stat in allrounder_stats %}
                        <tr>
                            <td>{{ stat.name }}</td>
                            <td>{{ stat.matches }}</td>
                            <td>{{ stat.runs }}</td>
                            <td>{{ "%.2f"|format(stat.batting_average) }}</td>
                            <td>{{ "%.2f"|format(stat.strike_rate) }}</td>
                            <td>{{ stat.wickets }}</td>
                            <td>{{ "%.2f"|format(stat.economy) }}</td>
                            <td>{{ "%.2f"|format(stat.bowling_average) }}</td>
                            <td>
                                <div class="progress">
                                    <div class="progress-bar bg-success" 
                                         role="progressbar" 
                                         style="width: {{ (stat.all_round_rating/200)*100 }}%">
                                        {{ "%.1f"|format(stat.all_round_rating) }}
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Batting Analysis -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0">Batting Performances</h2>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover" id="batting-table">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="name">Player <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="matches">Matches <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="runs">Runs <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="average">Average <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="strike_rate">Strike Rate <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="highest">Highest Score <span class="sort-icon">↕</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stat in batting_stats %}
                        <tr>
                            <td>{{ stat.name }}</td>
                            <td>{{ stat.matches }}</td>
                            <td>{{ stat.runs }}</td>
                            <td>{{ "%.2f"|format(stat.average) }}</td>
                            <td>{{ "%.2f"|format(stat.strike_rate) }}</td>
                            <td>{{ stat.highest }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Bowling Analysis -->
    <div class="card">
        <div class="card-header bg-success text-white">
            <h2 class="h5 mb-0">Bowling Performances</h2>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover" id="bowling-table">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="name">Player <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="matches">Matches <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="wickets">Wickets <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="economy">Economy <span class="sort-icon">↕</span></th>
                            <th class="sortable" data-sort="best">Best Figures <span class="sort-icon">↕</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stat in bowling_stats %}
                        <tr>
                            <td>{{ stat.name }}</td>
                            <td>{{ stat.matches }}</td>
                            <td>{{ stat.wickets }}</td>
                            <td>{{ "%.2f"|format(stat.economy) }}</td>
                            <td>{{ stat.best }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Add a visual comparison section -->
<div class="card mt-4">
    <div class="card-header bg-info text-white">
        <h2 class="h5 mb-0">Performance Comparison</h2>
    </div>
    <div class="card-body">
        <div class="row">
            {% for stat in allrounder_stats[:3] %}
            <div class="col-md-4">
                <div class="player-comparison-card">
                    <h3>{{ stat.name }}</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="label">Batting</span>
                            <div class="progress">
                                <div class="progress-bar bg-primary" 
                                     style="width: {{ (stat.batting_average/50)*100 }}%">
                                    {{ "%.1f"|format(stat.batting_average) }}
                                </div>
                            </div>
                        </div>
                        <div class="stat-item">
                            <span class="label">Bowling</span>
                            <div class="progress">
                                <div class="progress-bar bg-success" 
                                     style="width: {{ (stat.wickets/10)*100 }}%">
                                    {{ stat.wickets }} wkts
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Add sorting JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tables = ['allrounder-table', 'batting-table', 'bowling-table'];
    
    tables.forEach(tableId => {
        const table = document.getElementById(tableId);
        const headers = table.querySelectorAll('th.sortable');
        
        headers.forEach(header => {
            header.addEventListener('click', () => {
                const sortBy = header.dataset.sort;
                const currentDirection = header.dataset.direction || 'asc';
                const newDirection = currentDirection === 'asc' ? 'desc' : 'asc';
                
                // Update sort direction
                headers.forEach(h => {
                    h.dataset.direction = '';
                    h.querySelector('.sort-icon').textContent = '↕';
                });
                header.dataset.direction = newDirection;
                header.querySelector('.sort-icon').textContent = newDirection === 'asc' ? '^' : '˅';
                
                // Sort the table
                const tbody = table.querySelector('tbody');
                const rows = Array.from(tbody.querySelectorAll('tr'));
                
                rows.sort((a, b) => {
                    const aValue = a.children[Array.from(header.parentNode.children).indexOf(header)].textContent;
                    const bValue = b.children[Array.from(header.parentNode.children).indexOf(header)].textContent;
                    
                    // Handle numeric values
                    const aNum = parseFloat(aValue);
                    const bNum = parseFloat(bValue);
                    
                    if (!isNaN(aNum) && !isNaN(bNum)) {
                        return newDirection === 'asc' ? aNum - bNum : bNum - aNum;
                    }
                    
                    // Handle text values
                    return newDirection === 'asc' 
                        ? aValue.localeCompare(bValue)
                        : bValue.localeCompare(aValue);
                });
                
                // Reorder rows
                rows.forEach(row => tbody.appendChild(row));
            });
        });
    });
});
</script>
{% endblock %}